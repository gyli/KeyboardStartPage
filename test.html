<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="style.css">
    <script>
        function log(str) {
            logarea.value=str+"\n"+logarea.value;
        }

        form.addEventListener('submit', function(ev) {
            var newValue=input.value;
            chrome.storage.sync.set({"myValue": newValue}, function() {
                log("setting myValue to "+newValue);
            });
            ev.preventDefault();
        });

        function valueChanged(newValue) {
            output.innerText = newValue;
            output.className="changed";
            window.setTimeout(function() {output.className="";}, 200);
            log("value myValue changed to "+newValue);
        }

        // For debugging purposes:
        function debugChanges(changes, namespace) {
            for (key in changes) {
                console.log('Storage change: key='+key+' value='+JSON.stringify(changes[key]));
            }
        }

        chrome.storage.onChanged.addListener(function(changes, namespace) {
            if (changes["myValue"]) {
                valueChanged(changes["myValue"].newValue);
            }
            debugChanges(changes, namespace);
        });

        chrome.storage.sync.get("myValue", function(val) {valueChanged(val.myValue)});
    </script>>
</head>
<body>
<h1>Syncable storage</h1>
<small>Use chrome.storage.sync to share small chunks of data among all of your Chrome devices. To test, open this app in two different devices, both signed in with the same user.</small>
<p>This is the current value in the storage:</p>
<div id="output"></div>
<form>
    <label>Want to change it?</label>
    <input name="myValue" id="myValue" />
    <input type="submit" value="change"></input>
</form>
<textarea id="log"></textarea>
</body>
</html>